<!DOCTYPE html>
<html class="x-admin-sm">
<head>
    <meta charset="UTF-8">
    <title>欢迎页面-X-admin2.2</title>
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width,user-scalable=yes, minimum-scale=0.4, initial-scale=0.8,target-densitydpi=low-dpi" />
    <link rel="stylesheet" href="./css/font.css">
    <link rel="stylesheet" href="./css/xadmin.css">
    <script type="text/javascript" src="./lib/layui/layui.js" charset="utf-8"></script>
    <script type="text/javascript" src="./js/xadmin.js"></script>
    <div class="x-nav">
        <a class="layui-btn layui-btn-small" style="line-height:1.6em;margin-top:3px;float:right" onclick="location.reload()" title="刷新">
            <i class="layui-icon layui-icon-refresh" style="line-height:30px"></i>
        </a>
    </div>
    <style>
        .layui-form-label:after{
            content:"*";
            color:red;
            position: absolute;
        }
    </style>
    <!-- 你的HTML代码 -->
    <table id="demo" lay-filter="test"></table>

    <script type="text/html" id="toolbarDemo">
        <div class = "layui-btn-container">
            <button style="font-size:18px;" class = "layui-btn layui-btn-sm"  >  销售月统计表 </button>
        </div >
    </script>
    <!--<script src="__STATIC__/layui/layui.js"></script>-->
    <!-- 编辑弹窗页面 -->
    <div class="layui-row" id="edit" style="display:none;" lay-filter="edit">
        <div class="layui-col-md10">
            <form class="layui-form layui-from-pane" method="post" lay-fitler="sys-user-edit" style="margin-top:20px">
                <div class="layui-inline">
                    <label class="layui-form-label">选择组别</label>
                    <div class="layui-input-inline">
                        <select name="class" lay-verify="required" lay-search="">
                            <option value="1">1组</option>
                            <option value="2">2组</option>
                        </select>
                    </div>
                </div>
<!--   <hr>-->
                <div class="layui-inline">
                    <label class="layui-form-label">销售名称</label>
                    <div class="layui-input-inline">
                        <input type="text" name="name" id="name" autocomplete="off" class="layui-input">
                    </div>
                </div>
                <div class="layui-inline">
                    <label class="layui-form-label">微信号</label>
                    <div class="layui-input-inline">
                        <input type="text" name="wechat" id="wechat" autocomplete="off" class="layui-input">
                    </div>
                </div>
<!--                <div class="layui-inline">-->
<!--                    <label class="layui-form-label">sh</label>-->
<!--                    <div class="layui-input-inline">-->
<!--                        <input type="text" name="wechat" id="sh" autocomplete="off" class="layui-input">-->
<!--                    </div>-->
<!--                </div>-->
                <div class="layui-inline">
                    <label class="layui-form-label">进粉合计</label>
                    <div class="layui-input-inline">
                        <input type="text" name="fink" id="fink" autocomplete="off" class="layui-input">
                    </div>
                </div>
<!--                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-->
                <div class="layui-inline">
                    <label class="layui-form-label">总开单率</label>
                    <div class="layui-input-inline">
                        <input type="text" name="cate" id="cate" class="layui-input">
                    </div>
                </div>
                <div class="layui-inline">
                    <label class="layui-form-label">总开单数</label>
                    <div class="layui-input-inline">
                        <input type="text" name="count" id="count" autocomplete="off" class="layui-input">
                    </div>
                </div>
                <div class="layui-inline">
                    <label class="layui-form-label">总开单金额</label>
                    <div class="layui-input-inline">
                        <input type="text" name="countmoney" id="countmoney" autocomplete="off" class="layui-input">
                    </div>
                </div>
<!--                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-->
                <div class="layui-inline">
                    <label class="layui-form-label">总平均金额</label>
                    <div class="layui-input-inline">
                        <input type="text" name="catemoney" id="catemoney" autocomplete="off" class="layui-input">
                    </div>
                </div>
                <div class="layui-form-item">
                    <!-- <label class="layui-form-label">ID</label> -->
                    <!--接受编辑请求的id-->
                    <input class="id" name="id" type="hidden" value="">
                </div>
                <div class="layui-form-item" style="margin-top:40px">
                    <div class="layui-input-block">
                        <button class="layui-btn  layui-btn-submit " lay-submit="edit" lay-filter="edit">确认修改</button>
                        <button type="reset" class="layui-btn layui-btn-primary">重置</button>
                    </div>
                </div>
            </form>
        </div>
    </div>
    <div class="layui-row" id="add" style="display:none;" lay-filter="add">
        <div class="layui-col-md10">
            <form class="layui-form layui-from-pane" method="post" lay-fitler="sys-user-add" style="margin-top:20px">
                <div class="layui-inline">
                    <label class="layui-form-label">选择组别</label>
                    <div class="layui-input-inline">
                        <select name="class" lay-verify="required" lay-search="">
                            <option value="1">1组</option>
                            <option value="2">2组</option>
                        </select>
                    </div>
                </div>
                <!--                <hr>-->
                <div class="layui-inline">
                    <label class="layui-form-label">销售名称</label>
                    <div class="layui-input-inline">
                        <input type="text" name="name" id="newname" autocomplete="off" class="layui-input">
                    </div>
                </div>
                <div class="layui-inline">
                    <label class="layui-form-label">微信号</label>
                    <div class="layui-input-inline">
                        <input type="text" name="wechat" id="newwechat" autocomplete="off" class="layui-input">
                    </div>
                </div>
                <div class="layui-inline">
                    <label class="layui-form-label">进粉合计</label>
                    <div class="layui-input-inline">
                        <input type="text" name="fink" id="newfink" autocomplete="off" class="layui-input">
                    </div>
                </div>
                <!--                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-->
                <div class="layui-inline">
                    <label class="layui-form-label">总开单率</label>
                    <div class="layui-input-inline">
                        <input type="text" name="cate" id="newcate" class="layui-input">
                    </div>

                </div>
                <div class="layui-inline">
                    <label class="layui-form-label">总开单数</label>
                    <div class="layui-input-inline">
                        <input type="text" name="count" id="newcount" autocomplete="off" class="layui-input">
                    </div>
                </div>
                <div class="layui-inline">
                    <label class="layui-form-label">总开单金额</label>
                    <div class="layui-input-inline">
                        <input type="text" name="countmoney" id="newcountmoney" autocomplete="off" class="layui-input">
                    </div>
                </div>
                <!--                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-->
                <div class="layui-inline">
                    <label class="layui-form-label">总平均金额</label>
                    <div class="layui-input-inline">
                        <input type="text" name="catemoney" id="newcatemoney" autocomplete="off" class="layui-input">
                    </div>
                </div>
                <div class="layui-form-item">
                <div class="layui-form-item" style="margin-top:40px">
                    <div class="layui-input-block">
                        <button class="layui-btn  layui-btn-submit " lay-submit="add" lay-filter="add">确认添加</button>
                        <button type="reset" class="layui-btn layui-btn-primary">重置</button>
                    </div>
                </div>
                </div>
            </form>
        </div>

    </div>
    <!--<div class="layui-card-header">-->
    <!--</div>-->
    <script type="text/html" id="barDemo">
        <a class="layui-btn layui-btn-xs" lay-event="edit" >编辑</a>
        <a class="layui-btn layui-btn-normal" lay-event="add">新增</a>
        <a class="layui-btn layui-btn-danger layui-btn-xs" lay-event="del">删除</a>
    </script>
    <!-- 数据表格容器 -->
    <div style="text-align:center">
        <!--style="text-align:center"-->
        <table class="layui-hide" id="LAY_table_user" lay-filter="user"></table>
    </div>
    <script type="text/html" id="buttonTpl">
        {{#  if(d.states == 1){ }}
        <button class="layui-btn layui-btn-xs"  lay-event="status">已上架</button>
        {{#  } }}
        {{# if(d.states == 2){ }}
        <button class="layui-btn layui-btn-danger layui-btn-xs" lay-event="status">已下架</button>
        {{#  } }}
    </script>
    <script>
        layui.use('table', function () {
            var table = layui.table;
            //实现表格查询处所有接口中的数据
            table.render({
                elem: '#LAY_table_user'//绑定table表格
                , url: "http://admin.beijing301.cn/index/peopl/getpeopl"//读取用户的接口
                , cols: [[
                    // { type: 'checkbox' }
                    { field: 'id', title: 'ID', width: 50, sort: true, hide: true }//hide：true 为隐藏id
                    , { field: 'class', title: '销售组别', width: 100,totalRowText:'合计：',templet: function (d) {
                            if (d.class =='1'){
                                return '1组'
                            }else if(d.class == '2'){
                                return '2组'
                            }
                        }}
                    , { field: 'name', title: '销售名称', width: 110}
                    , { field: 'wechat', title: '微信号', width: 130}
                    , { field: 'fink', title: '总进粉合计', width: 110,totalRow:true}
                    , { field: 'cate', title: '总开单率', width: 110,style:'color: red;font-size:16px;'}
                    , { field: 'count', title: '总开单数', width: 110,style:'color: red;font-size:16px;',totalRow:true}
                    , { field: 'countmoney', title: '总开单金额', width: 130,style:'color: red;font-size:16px;',totalRow:true}
                    , { field: 'catemoney', title: '总平均额', width: 110}
                    , { field: 'createtime', title: '时间', width: 150}
                    ,{field: 'states', title:'审核状态', templet: '#buttonTpl', minWidth: 80, align: 'center'}
                    , { fixed: 'right', title: '操作', width: 208, align: 'center', toolbar: '#barDemo' }//显示编辑删除查看的 toolbar是用来让a标签识别的
                ]]
                , id: 'testReload'//给table取了个id  重载与其他验证时使用
                , page: true//开启分页
                , limit: 20//决定数据表格每一页加载多少商品展示出来
                ,toolbar: '#toolbarDemo'
                ,totalRow:true
            });

            var $ = layui.$, active = {
                getCheckData: function () { //获取选中数据
                    var checkStatus = table.checkStatus('testReload')
                        , data = checkStatus.data;
                    if(data == '')
                    {
                        layer.msg("请先勾选商品", { icon: 5 });
                        return false;
                    }
                    //数组容器
                    var arr = [];
                    //遍历进数组
                    $.each(data, function (i) {
                        arr.push(data[i].id);
                    });
                    //展示要删除的商品
                    var delname = [];
                    $.each(data, function (o) {
                        delname.push(data[o].name);
                    });
                    //删除前 询问确定删除？
                    layer.confirm('要删除商品名为 ' +"<strong style='color:red'>"+ delname +"</strong>"+ ' 的商品吗？', { icon: 3 }, function (index) {
                        $.ajax({
                            url:"{:url('api/v3.index/delall')}",
                            type:"post",
                            data:{
                                id:arr
                            },
                            success:function(del)
                            {
                                if (del.suc == 200) {
                                    layer.closeAll();//修改成功后关闭所有弹窗
                                    layer.msg("删除成功", { icon: 6 });
                                    $('.layui-laypage-btn').trigger('click');// ￥￥￥一行代码直接表格重载(牛逼！！)￥￥￥
                                } else if (del.err == 400) {
                                    layer.closeAll();//修改成功后关闭所有弹窗
                                    layer.msg("暂无删除商品权限！", { icon: 5 });
                                } else {
                                    layer.msg("修改失败", { icon: 5 });
                                }
                            }
                        })
                        layer.close(index);
                    });//删除弹框结束
                    // console.log(arr);//将id数组发送给接口删除即可
                }

                , getCheckLength: function () { //获取选中数目
                    var checkStatus = table.checkStatus('testReload')
                        , data = checkStatus.data;
                    layer.msg('选中了：' + data.length + ' 个');
                }
                , isAll: function () { //验证是否全选
                    var checkStatus = table.checkStatus('testReload');
                    layer.msg(checkStatus.isAll ? '全选' : '未全选')
                }
            };
            //获取数据的点击事件
            $('.demoTable .layui-btn').on('click', function () {
                var type = $(this).data('type');
                active[type] ? active[type].call(this) : '';
            });
        });
    </script>

    <script>
        //form表单开始
        layui.use('form', function () {
            var form = layui.form;
            var $ = layui.jquery;//引入jq
            //监听form提交
            form.on('submit(edit)', function (data) {
                // console.log(data.field)//查看发送时的数据
                $.ajax({
                    url: "http://admin.beijing301.cn/index/peopl/editpeopl ",
                    type: 'POST',
                    data: {
                        //从form表单中监听的数据 发送给后端API
                        'id': data.field.id,
                        'class': data.field.class,
                        'name': data.field.name,
                        'wechat': data.field.wechat,
                        'fink': data.field.fink,
                        'cate': data.field.cate,
                        'count': data.field.count,
                        'countmoney': data.field.countmoney,
                        'catemoney': data.field.catemoney,
                    },
                    success: function (msg) {
                        // console.log(msg)
                        //var returnCode = msg.returnCode;//取得返回数据（Sting类型的字符串）的信息进行取值判断
                        if (msg.suc == 200) {
                            // console.log(msg.data)
                            layer.closeAll();//修改成功后关闭所有弹窗
                            layer.msg("修改成功", { icon: 6 });
                            $('.layui-laypage-btn').trigger('click');// ￥￥￥一行代码直接表格重载(牛逼！！)￥￥￥
                        } else if (msg.err == 400) {
                            layer.closeAll();//修改成功后关闭所有弹窗
                            layer.msg("没有修改权限！已记录该账号违规操作！", { icon: 5 });
                        } else {
                            layer.msg("修改失败", { icon: 5 });
                        }
                    }
                });
                return false;//阻止form表单二次提交
            });
            form.on('submit(add)', function (datas) {
                // console.log(datas.field)//查看发送时的数据
                $.ajax({
                    url: "http://admin.beijing301.cn/index/peopl/addpeopl",
                    type: 'POST',
                    data: {
                        //从form表单中监听的数据 发送给后端API
                        'class': datas.field.class,
                        'name': datas.field.name,
                        'wechat': datas.field.wechat,
                        'fink': datas.field.fink,
                        'cate': datas.field.cate,
                        'count': datas.field.count,
                        'countmoney': datas.field.countmoney,
                        'catemoney': datas.field.catemoney,
                    },
                    success: function (msg) {
                        // console.log(msg)
                        //var returnCode = msg.returnCode;//取得返回数据（Sting类型的字符串）的信息进行取值判断
                        if (msg.suc == 200) {
                            // console.log(msg.data)
                            layer.closeAll();//修改成功后关闭所有弹窗
                            layer.msg("新增网址成功", { icon: 6 });
                            $('.layui-laypage-btn').trigger('click');// ￥￥￥一行代码直接表格重载(牛逼！！)￥￥￥
                        } else if (msg.err == 400) {
                            layer.closeAll();//修改成功后关闭所有弹窗
                            layer.msg("没有新增权限！已记录该账号违规操作！", { icon: 5 });
                        } else {
                            layer.msg("新增失败", { icon: 5 });
                        }
                    }
                });
                return false;//阻止form表单二次提交
            });
        });
    </script>

    <script>
        layui.use('table', function () {
            var table = layui.table;
            // var form = layer.form;
            var $ = layui.jquery;//引入jq
            //监听表格复选框选择
            //table.on('checkbox(table中的lay-filter="user")')
            table.on('checkbox(user)', function (obj) {
                //console.log(obj)
                //打印被选中的数据
            });
            //监听工具条
            table.on('tool(user)', function (obj) {
                var data = obj.data;
                if (obj.event === 'del') {
                    layer.confirm('确定要删除销售名称为 ' +"<strong style='color:red'>"+ data.name +"</strong>"+ ' 账单吗？', { icon: 3 }, function (index) {
                        // obj.del();
                        //layer.close(index);
                        $.ajax({
                            url: "http://admin.beijing301.cn/index/peopl/delpeopl",
                            type: 'get',
                            data: { 'id': data.id },//向服务端发送删除的id
                            success: function (suc) {
                                if (suc.suc == 200) {
                                    obj.del(); //删除对应行（tr）的DOM结构，并更新缓存
                                    layer.close(index);
                                    // console.log(index);
                                    layer.msg("删除成功", { icon: 6 });
                                } else if (suc.err == 400) {
                                    layer.msg("没有删除权限！已记录该账号违规操作！", { icon: 5 });
                                } else {
                                    layer.msg("删除失败", { icon: 5 });
                                }
                            }
                        });
                        layer.close(index);
                    });//删除弹框结束
                } else if (obj.event === 'edit') {
                    //赋值给form表单操作
                    $('.id').val(data.id);//重点￥##：jq获取table表格给form表单class属性值为id的
                    $('#name').val(data.name);//将商品历史名字带入父级框
                    $('#wechat').val(data.wechat);
                    $('#fink').val(data.fink);
                    $('#cate').val(data.cate);
                    $('#count').val(data.count);
                    $('#countmoney').val(data.countmoney);
                    $('#catemoney').val(data.catemoney);
                    // $('#class').val();
                    // $('.class option:selected').val(data.class);
                    layer.open({
                        //layer提供了5种层类型。可传入的值有：0（信息框，默认）1（页面层）2（iframe层）3（加载层）4（tips层）
                        skin: 'layui-layer-rim',
                        shadeClose: true, //点击遮罩关闭层
                        type: 1,
                        title: "修改销售人员表单",
                        area: ['400px', '470px'],
                        content: $("#edit"),//引用的弹出层的页面层的方式加载修改界面表单
                    });

                }else if (obj.event === 'add') {
                    //赋值给form表单操作
                    layer.open({
                        //layer提供了5种层类型。可传入的值有：0（信息框，默认）1（页面层）2（iframe层）3（加载层）4（tips层）
                        skin: 'layui-layer-rim',
                        shadeClose: true, //点击遮罩关闭层
                        type: 1,
                        title: "新增销售人员表单",
                        area: ['400px', '470px'],
                        content: $("#add"),//引用的弹出层的页面层的方式加载修改界面表单
                    });

                }else if (obj.event === 'status') {
                    //赋值给form表单操作
                        alert('1121');
                }

            });

            //table.checkstatus('table表格中的id')绑定即可
        });
    </script>

    </body>


</html>